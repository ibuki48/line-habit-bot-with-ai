<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Habit Bot</title>
    <!-- LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  </head>

  <body>
    <!-- 表示用 -->
    <h1 id="hello">読み込み中...</h1>

    <!-- 操作用ボタン -->
    <button id="done">やった！</button>
    <button id="skip">スキップ</button>

    <!-- あなたのJavaScriptコード -->
    <script>
      const LIFF_ID = "2007916846-QZqzAmjW"; // あなたのLIFF ID

      async function main() {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) { liff.login(); return; }

        const profile = await liff.getProfile();
        document.getElementById("hello").textContent = `こんにちは、${profile.displayName} さん`;
      }

      async function send(status) {
        try {
          await fetch("https://script.google.com/macros/s/AKfycbwrwEN0RE9M6eC1BaCXjhwbR_vmu-oRKR502XuRtI4t9PRUQ73JL2fSbvK7f1nvIs--gg/exec", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              userId: profile.userId,
              status,
              ts: new Date().toISOString(),
              source: "liff"
            })
          });
          alert("送信しました！");
          if (liff.isInClient()) liff.closeWindow();
        } catch (e) {
          console.error(e);
          alert("送信でエラーが起きました");
        }
      }

      document.getElementById("done").addEventListener("click", () => send("done"));
      document.getElementById("skip").addEventListener("click", () => send("skip"));

      main().catch(e => {
        console.error(e);
        document.getElementById("hello").textContent = "エラーが起きました";
      });
    </script>
  </body>
</html>
