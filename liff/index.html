<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
  const LIFF_ID = "2007916846-QZqzAmjW"; // LIFFコンソールで発行されたIDに置き換え

  async function main() {
    await liff.init({ liffId: LIFF_ID });
    if (!liff.isLoggedIn()) {
      liff.login();
      return;
    }

    const profile = await liff.getProfile();
    document.getElementById("hello").textContent = `こんにちは、${profile.displayName} さん`;

    // 送信処理
    async function send(status) {
      try {
        await fetch("https://script.google.com/macros/s/AKfycbwrwEN0RE9M6eC1BaCXjhwbR_vmu-oRKR502XuRtI4t9PRUQ73JL2fSbvK7f1nvIs--gg/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            userId: profile.userId,
            status: status,
            ts: new Date().toISOString(),
            source: "liff"
          })
        });

        alert("送信しました！");
        if (liff.isInClient()) liff.closeWindow();
      } catch (e) {
        console.error(e);
        alert("送信でエラーが起きました");
      }
    }

    // ボタンにイベントを追加
    document.getElementById("done").addEventListener("click", () => send("done"));
    document.getElementById("skip").addEventListener("click", () => send("skip"));
  }

  main().catch(e => {
    console.error(e);
    document.getElementById("hello").textContent = "エラーが起きました";
  });
</script>
